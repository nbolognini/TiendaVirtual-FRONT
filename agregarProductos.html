<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Cargar Productos</title>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="css/custom.css">
</head>
<body>


    <!-- Estructura del carro, se guarda en LocalStorage ahora.-->
<header id="header" class="header">
    <div class="container">
        <div class="row">
            <div class="four columns">
                <img src="img/logo.jpg" id="logo">
            </div>
            <div class="two columns u-pull-right">
                <ul>
                        <img src="img/cart2.png" id="img-carrito2">
                            <!--- Datos del carro-->
                        <div id="carrito">
                                <!-- Contenido del carrito -->    
                                <thead>
                                    <tr>
                                        <th></th>
                                    </tr>
                                </thead>
                                    <tbody></tbody>
                            </table>
                                    <!--- Boton que acciona Vaciar lista-carrito en JS -->
                        </div>
                    </li>
                </ul>
            </div>
        </div> 
    </div>
</header>
    <!--Barra que separa la parte fija del carro de arriba-->
    <div class="barra">
        <div class="container">
            <div class="row">
            </div>
        </div>
    </div>
    <br><br><br><br>
    <br><br>

    <h1>Cargar Productos</h1>

    <div class="productoForm">
        <form id="productoForm">
            <h5>Nuevo Producto:</h5>
            <!-- Tus campos de entrada aquí -->
            <select id="nombre">
              </select><br>
              <input type="number" id="precio" placeholder="Valor unitario del producto" step="0.01"><br>
                <input type="number" id="stock" placeholder="Cantidad en stock"><br>
            <!-- Botón para enviar el formulario y llamar a la función que envía el objeto -->
            <button id="agregarProductoAlLocalStorage" class='class="u-full-width button-primary4 button input agregar-carrito'">Agregar producto</button>
            <button id="limpiarLocalStorage" class='class="u-full-width button-primary2 button input agregar-carrito'>Borrar pre-carga</button>
        </form>
             
   
        <button id="guardarEnBD" class='class="u-full-width button-primary3 button input agregar-carrito'>Guardar en Base de Datos</button>
    </div>

    <br><br>

    <div class="contenedorBase">
        <div id="renderizarProductos" class="containerAgregarProductos"></div>
    </div>
        
        




    
    <script>
        // Cargar los productos en el select
const select = document.querySelector('#nombre');
const nombres = [
    "Remera", "Pantalon", "Zapatillas", "Campera", "Buzo", "Short", "Medias", "Gorra", "Mochila", "Bermuda"
];

nombres.forEach(nombre => {
    const option = document.createElement('option');
    option.value = nombre; // Corregido para usar nombre
    option.textContent = nombre; // Corregido para usar nombre
    select.appendChild(option);
});



document.addEventListener('DOMContentLoaded', cargarEventListeners);

function cargarEventListeners() {
    document.querySelector('#productoForm').addEventListener('submit', agregarProductoAlLocalStorage);
    document.querySelector('#limpiarLocalStorage').addEventListener('click', limpiarLocalStorage);
}

function agregarProductoAlLocalStorage(e) {
    e.preventDefault();
    const nombre = document.querySelector('#nombre').value;
    const precio = document.querySelector('#precio').value;
    const stock = document.querySelector('#stock').value;

    // Verificar si el campo 'precio' o 'stock' están vacíos
    if (precio.trim() === '' || stock.trim() === '') {
        console.log('El valor unitario y la cantidad no pueden estar vacíos');
        return; // Detener la ejecución de la función
    }

    const producto = { nombre, precio, stock };
    let productos = obtenerProductosLocalStorage();
    productos.push(producto);
    localStorage.setItem('productos', JSON.stringify(productos));
    alert('Producto agregado');
    document.querySelector('#productoForm').reset();
    location.reload(); // Recarga la página para mostrar el nuevo producto en la lista
}

function obtenerProductosLocalStorage() {
    let productos;
    if(localStorage.getItem('productos') === null) {
        productos = [];
    } else {
        productos = JSON.parse(localStorage.getItem('productos'));
    }
    return productos;
}

function limpiarLocalStorage() {
    // Limpio el formulario
    document.querySelector('#productoForm').reset();
    // Limpio específicamente el item 'productos' del localStorage
    localStorage.removeItem('productos');
    //Inicializo localStorage vacio
    location.reload();
    consonle.log('LocalStorage limpiado');
}

document.addEventListener('DOMContentLoaded', function() {
    const resultadoHTML = document.getElementById('resultadoHTML');
    const productos = JSON.parse(localStorage.getItem('productos'));

    if (productos) {
        let contenido = '<ul>';
        productos.forEach(producto => {
            contenido += `<li>Tipo: ${producto.nombre}, Precio: ${producto.precio}, Stock: ${producto.stock}</li>`;
        });
        contenido += '</ul>';
        resultadoHTML.innerHTML = contenido;
    } else {
        resultadoHTML.innerHTML = 'No hay productos pre-cargados.';
    }
});

function renderizarProductos(productos) {
    const elementoRenderizarProductos = document.getElementById('renderizarProductos');
    let html = '';
    productos.forEach(producto => {
        html += `
            <div class="row">
                <div class="nine columns">
                    <div class="card2">
                        <img src="img/${producto.nombre}.jpg" class="imagen-producto u-full-width">
                        <div class="info-card">
                            <h4>${producto.nombre}</h4>
                            <p>stock: ${producto.stock}</p>
                            <p></p>
                                <h4><textoDerecha class="center">Valor: $${producto.precio}</textoDerecha></p>
                            <a href="#" class="u-full-width button-primary2 button input agregar-carrito" onclick="eliminarProducto(${producto.id})">Borrar</a>
                        </div>
                    </div>
                </div>
            </div>
             
        `;
    });
    elementoRenderizarProductos.innerHTML = html;
}

// Función para recuperar productos de localStorage y mostrarlos
function mostrarProductosDesdeLocalStorage() {
    const productos = JSON.parse(localStorage.getItem('productos')) || [];
    renderizarProductos(productos);
}

// Llamar a mostrarProductosDesdeLocalStorage cuando la página se carga
document.addEventListener('DOMContentLoaded', mostrarProductosDesdeLocalStorage);


//FALTA TERMINAR: Función para eliminar un producto del localStorage
//function eliminarProducto(idProducto) {
//    // Lógica para eliminar el producto del almacenamiento o la lista
//    console.log("Producto a eliminar:", idProducto);
//    // Aquí iría el código para eliminar el producto del localStorage o de la estructura de datos que estés utilizando
//}   


document.getElementById('guardarEnBD').addEventListener('click', function() {
    // Recuperar el array de productos de localStorage
    const productos = JSON.parse(localStorage.getItem('productos'));

    if (!productos) {
        alert('No hay productos para guardar.');
        return;
    }

    // Enviar los productos al backend
    fetch('http://127.0.0.1:3000/guardarProductos', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ productos }), // Back va recibir un  objeto con una propiedad productos que es un array
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        throw new Error('Error en la solicitud: ' + response.statusText);
    })
    .then(data => {
        console.log(data); // Procesar la respuesta del servidor
        alert('Productos guardados con éxito');
        limpiarLocalStorage();
    })
    .catch(error => {
        console.error('Error al guardar los productos:', error);
        alert('Productos guardados con éxito');
        limpiarLocalStorage();
    });
});

    </script>

</body>
</html>
